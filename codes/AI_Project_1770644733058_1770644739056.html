<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro - World Class To-Do List</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: #f7f9fc; }
        /* Custom scrollbar for better aesthetics */
        .task-list-container::-webkit-scrollbar { width: 8px; }
        .task-list-container::-webkit-scrollbar-thumb { background-color: #4338ca; border-radius: 10px; }
        .task-list-container::-webkit-scrollbar-track { background-color: #e5e7eb; }

        .hidden-modal { visibility: hidden; opacity: 0; transition: visibility 0s, opacity 0.3s linear; }
        .visible-modal { visibility: visible; opacity: 1; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4338ca', // Indigo 700
                        'primary-light': '#818cf8', // Indigo 400
                        'secondary': '#10b981', // Emerald 500
                    },
                    boxShadow: {
                        '3xl': '0 35px 60px -15px rgba(0, 0, 0, 0.3)',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen antialiased">

    <!-- Task Modal (Hidden by default) -->
    <div id="taskModal" class="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center hidden-modal" onclick="closeModal(event)">
        <div class="bg-white rounded-xl shadow-3xl w-11/12 md:w-2/3 lg:w-1/3 p-6 transition-all duration-300 transform scale-95" onclick="event.stopPropagation()">
            <h2 id="modalTitle" class="text-2xl font-bold mb-4 text-primary">Add New Task</h2>
            <form id="taskForm" onsubmit="handleTaskSubmit(event)">
                
                <input type="hidden" id="taskId">

                <div class="mb-4">
                    <label for="title" class="block text-sm font-medium text-gray-700">Task Title <span class="text-red-500">*</span></label>
                    <input type="text" id="title" required class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" placeholder="e.g., Finish Q3 Report Draft">
                </div>

                <div class="mb-4">
                    <label for="description" class="block text-sm font-medium text-gray-700">Details</label>
                    <textarea id="description" rows="3" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150" placeholder="Optional notes about the task..."></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700">Category <span class="text-red-500">*</span></label>
                        <select id="category" required class="mt-1 p-3 w-full border border-gray-300 bg-white rounded-lg focus:ring-primary focus:border-primary transition duration-150">
                            <!-- Options filled by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="priority" class="block text-sm font-medium text-gray-700">Priority</label>
                        <select id="priority" class="mt-1 p-3 w-full border border-gray-300 bg-white rounded-lg focus:ring-primary focus:border-primary transition duration-150">
                            <option value="Low">Low</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="High">High</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="dueDate" class="block text-sm font-medium text-gray-700">Due Date</label>
                    <input type="date" id="dueDate" class="mt-1 p-3 w-full border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150">
                </div>

                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition duration-200">Cancel</button>
                    <button type="submit" id="saveButton" class="px-4 py-2 bg-primary text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
                        <i data-lucide="save" class="w-5 h-5 mr-2"></i> Save Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Header / Navbar -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i data-lucide="list-checks" class="w-8 h-8 text-primary"></i>
                <span class="text-2xl font-bold text-gray-900">TaskFlow <span class="text-primary">Pro</span></span>
            </div>
            
            <!-- Global Search and User -->
            <div class="flex items-center space-x-4">
                <div class="relative hidden sm:block">
                    <input type="text" id="globalSearch" oninput="applyFilters()" placeholder="Search tasks..." 
                           class="py-2 pl-10 pr-4 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition w-64">
                    <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                </div>
                
                <button onclick="toggleTheme()" class="p-2 rounded-full text-gray-600 hover:bg-gray-100 transition">
                    <i data-lucide="sun-medium" id="themeIcon" class="w-6 h-6"></i>
                </button>

                <div class="w-10 h-10 rounded-full bg-primary-light flex items-center justify-center text-white font-semibold cursor-pointer">
                    AI
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6 pb-12">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sidebar (Desktop View) -->
            <aside class="lg:col-span-3 bg-white p-6 rounded-xl shadow-lg h-full lg:sticky lg:top-24">
                <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i data-lucide="layout-list" class="w-5 h-5 mr-2 text-primary"></i> Projects & Categories
                </h3>
                
                <!-- Category List -->
                <ul id="categoryList" class="space-y-2 mb-6">
                    <!-- Categories rendered here -->
                </ul>

                <button onclick="openModal()" class="w-full flex items-center justify-center py-2 px-4 bg-secondary text-white font-medium rounded-lg hover:bg-emerald-600 transition duration-200 shadow-md">
                    <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i> Add New Task
                </button>

                <hr class="my-6 border-gray-200">

                <!-- Stats Panel -->
                <div class="space-y-4">
                    <h4 class="font-semibold text-gray-800 flex items-center mb-3">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 mr-2 text-primary"></i> Statistics
                    </h4>
                    
                    <div id="statsTotal" class="p-3 bg-indigo-50 rounded-lg flex justify-between items-center text-primary border-l-4 border-primary">
                        <span class="font-medium">Total Tasks</span>
                        <span class="text-xl font-bold" id="statTotalCount">0</span>
                    </div>

                    <div id="statsCompleted" class="p-3 bg-emerald-50 rounded-lg flex justify-between items-center text-secondary border-l-4 border-secondary">
                        <span class="font-medium">Completed</span>
                        <span class="text-xl font-bold" id="statCompletedCount">0</span>
                    </div>

                    <div id="statsPending" class="p-3 bg-amber-50 rounded-lg flex justify-between items-center text-amber-600 border-l-4 border-amber-500">
                        <span class="font-medium">Pending</span>
                        <span class="text-xl font-bold" id="statPendingCount">0</span>
                    </div>
                </div>
            </aside>

            <!-- Main Task Area -->
            <section class="lg:col-span-9">
                
                <h1 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
                    <i data-lucide="rocket" class="w-7 h-7 mr-3 text-primary"></i> <span id="currentViewTitle">All Tasks</span>
                </h1>

                <!-- Filter & Sort Controls -->
                <div class="bg-white p-4 rounded-xl shadow-lg mb-6 flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0">
                    
                    <div class="flex space-x-2 w-full sm:w-auto">
                        <button onclick="setCompletionFilter('all')" id="filterAll" class="filter-btn px-4 py-2 text-sm font-medium bg-primary text-white rounded-lg transition duration-200">All</button>
                        <button onclick="setCompletionFilter('pending')" id="filterPending" class="filter-btn px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-200">Pending</button>
                        <button onclick="setCompletionFilter('completed')" id="filterCompleted" class="filter-btn px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition duration-200">Completed</button>
                    </div>

                    <div class="flex items-center space-x-2 w-full sm:w-auto">
                        <label class="text-sm font-medium text-gray-700 hidden md:block">Sort By:</label>
                        <select id="sortCriteria" onchange="applyFilters()" class="py-2 px-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-primary focus:border-primary w-full sm:w-auto">
                            <option value="date_desc">Newest First</option>
                            <option value="date_asc">Oldest First</option>
                            <option value="priority_desc">Priority (High to Low)</option>
                            <option value="due_date_asc">Due Date</option>
                        </select>
                    </div>
                </div>

                <!-- Task List Container -->
                <div id="taskListContainer" class="space-y-4 task-list-container h-[60vh] overflow-y-auto pr-2">
                    <!-- Tasks will be injected here -->
                    <p id="noTasksMessage" class="text-center text-gray-500 pt-12 text-lg italic hidden">
                        <i data-lucide="clipboard-list" class="w-8 h-8 mx-auto mb-2"></i>
                        No tasks found in this view. Time to relax or add a new one!
                    </p>
                </div>
                
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-12 border-t border-gray-200 py-6 text-center text-gray-500 text-sm">
        &copy; 2024 TaskFlow Pro. Built with professional precision using Vanilla JS & Tailwind CSS.
    </footer>

    <script>
        // ===========================================
        // 1. DATA MANAGEMENT & LOCAL STORAGE
        // ===========================================

        let tasks = [];
        let categories = ['Personal', 'Work', 'Finance', 'Health'];
        let currentCategoryFilter = 'All';
        let currentCompletionFilter = 'all';

        const selectors = {
            taskList: document.getElementById('taskListContainer'),
            categoryList: document.getElementById('categoryList'),
            modal: document.getElementById('taskModal'),
            form: document.getElementById('taskForm'),
            modalTitle: document.getElementById('modalTitle'),
            categorySelect: document.getElementById('category'),
            currentViewTitle: document.getElementById('currentViewTitle'),
            noTasksMessage: document.getElementById('noTasksMessage'),
            sortCriteria: document.getElementById('sortCriteria'),
            globalSearch: document.getElementById('globalSearch')
        };
        
        const loadData = () => {
            tasks = JSON.parse(localStorage.getItem('taskFlowTasks')) || [];
            categories = JSON.parse(localStorage.getItem('taskFlowCategories')) || categories;
        };

        const saveTasks = () => {
            localStorage.setItem('taskFlowTasks', JSON.stringify(tasks));
            updateStats();
        };

        const saveCategories = () => {
            localStorage.setItem('taskFlowCategories', JSON.stringify(categories));
        };

        // ===========================================
        // 2. UI UTILITIES (Modal, Theming)
        // ===========================================

        const openModal = (taskId = null) => {
            selectors.form.reset();
            populateCategorySelect();
            document.getElementById('taskId').value = '';

            if (taskId !== null) {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    selectors.modalTitle.textContent = 'Edit Task';
                    document.getElementById('taskId').value = task.id;
                    document.getElementById('title').value = task.title;
                    document.getElementById('description').value = task.description;
                    document.getElementById('category').value = task.category;
                    document.getElementById('priority').value = task.priority;
                    document.getElementById('dueDate').value = task.dueDate || '';
                    document.getElementById('saveButton').innerHTML = '<i data-lucide="pencil" class="w-5 h-5 mr-2"></i> Update Task';
                }
            } else {
                selectors.modalTitle.textContent = 'Add New Task';
                document.getElementById('saveButton').innerHTML = '<i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i> Save Task';
            }
            lucide.createIcons();
            selectors.modal.classList.remove('hidden-modal');
            selectors.modal.classList.add('visible-modal');
        };

        const closeModal = (event) => {
            if (!event || event.target === selectors.modal) {
                selectors.modal.classList.remove('visible-modal');
                selectors.modal.classList.add('hidden-modal');
            }
        };

        const populateCategorySelect = () => {
            selectors.categorySelect.innerHTML = categories.map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');
        };

        const toggleTheme = () => {
            const isDark = document.body.classList.toggle('dark');
            const icon = document.getElementById('themeIcon');
            
            if (isDark) {
                localStorage.setItem('taskFlowTheme', 'dark');
                document.body.style.backgroundColor = '#1f2937'; // Dark BG
                icon.setAttribute('data-lucide', 'moon');
                document.querySelectorAll('.bg-white').forEach(el => el.classList.replace('bg-white', 'bg-gray-800'));
                document.querySelectorAll('.text-gray-900').forEach(el => el.classList.replace('text-gray-900', 'text-gray-100'));
                document.querySelectorAll('.text-gray-700').forEach(el => el.classList.replace('text-gray-700', 'text-gray-300'));
            } else {
                localStorage.setItem('taskFlowTheme', 'light');
                document.body.style.backgroundColor = '#f7f9fc'; // Light BG
                icon.setAttribute('data-lucide', 'sun-medium');
                document.querySelectorAll('.bg-gray-800').forEach(el => el.classList.replace('bg-gray-800', 'bg-white'));
                document.querySelectorAll('.text-gray-100').forEach(el => el.classList.replace('text-gray-100', 'text-gray-900'));
                document.querySelectorAll('.text-gray-300').forEach(el => el.classList.replace('text-gray-300', 'text-gray-700'));
            }
            lucide.createIcons();
        };

        // ===========================================
        // 3. TASK CRUD LOGIC
        // ===========================================

        const handleTaskSubmit = (e) => {
            e.preventDefault();

            const taskId = document.getElementById('taskId').value;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const category = document.getElementById('category').value;
            const priority = document.getElementById('priority').value;
            const dueDate = document.getElementById('dueDate').value;

            if (!title || !category) {
                alert('Please fill in the Title and Category.');
                return;
            }

            const taskData = {
                title,
                description,
                category,
                priority,
                dueDate: dueDate || null,
                completed: false,
                createdAt: new Date().toISOString()
            };

            if (taskId) {
                // Edit existing task
                const index = tasks.findIndex(t => t.id === taskId);
                if (index !== -1) {
                    tasks[index] = { ...tasks[index], ...taskData };
                }
            } else {
                // Add new task
                taskData.id = Date.now().toString(36) + Math.random().toString(36).substr(2);
                tasks.push(taskData);
            }

            saveTasks();
            applyFilters(); // Re-render the list based on current filters
            closeModal();
        };

        const toggleCompletion = (id) => {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveTasks();
                applyFilters(); // Re-render
            }
        };

        const deleteTask = (id) => {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                applyFilters(); // Re-render
            }
        };


        // ===========================================
        // 4. RENDERING & FILTERING
        // ===========================================

        const getPriorityStyles = (priority) => {
            switch (priority) {
                case 'Urgent': return { color: 'text-red-600', border: 'border-red-500', icon: 'zap' };
                case 'High': return { color: 'text-orange-600', border: 'border-orange-500', icon: 'chevrons-up' };
                case 'Medium': return { color: 'text-primary', border: 'border-primary', icon: 'chevron-up' };
                default: return { color: 'text-gray-500', border: 'border-gray-400', icon: 'chevron-down' };
            }
        };

        const renderTaskItem = (task) => {
            const { color, border, icon } = getPriorityStyles(task.priority);
            
            const checkedClass = task.completed ? 'bg-secondary ring-secondary text-white' : 'bg-white ring-gray-300 text-gray-400';
            const textStyle = task.completed ? 'line-through text-gray-400' : 'text-gray-900';
            const dueDateDisplay = task.dueDate ? `<span class="flex items-center text-xs text-gray-500 mt-1"><i data-lucide="calendar" class="w-3 h-3 mr-1"></i> Due: ${new Date(task.dueDate).toLocaleDateString()}</span>` : '';

            return `
                <div class="task-card bg-white p-5 rounded-xl shadow-md flex items-start space-x-4 hover:shadow-lg transition duration-200 border-l-4 ${border}">
                    
                    <!-- Checkbox -->
                    <button onclick="toggleCompletion('${task.id}')" class="mt-1 flex-shrink-0 w-6 h-6 rounded-full ring-2 ${checkedClass} flex items-center justify-center transition duration-150">
                        <i data-lucide="check" class="w-4 h-4"></i>
                    </button>

                    <!-- Content -->
                    <div class="flex-grow">
                        <h3 class="text-lg font-semibold ${textStyle}">${task.title}</h3>
                        ${task.description ? `<p class="text-sm text-gray-600 mt-1 ${textStyle.replace('line-through', '')}">${task.description}</p>` : ''}
                        
                        <div class="flex items-center space-x-4 mt-2 text-xs">
                            <span class="px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 font-medium">${task.category}</span>
                            <span class="flex items-center ${color} font-medium">
                                <i data-lucide="${icon}" class="w-3 h-3 mr-1"></i> ${task.priority}
                            </span>
                            ${dueDateDisplay}
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex flex-col space-y-2 flex-shrink-0">
                        <button onclick="openModal('${task.id}')" class="p-2 text-primary hover:bg-indigo-50 rounded-full transition" title="Edit Task">
                            <i data-lucide="pencil" class="w-4 h-4"></i>
                        </button>
                        <button onclick="deleteTask('${task.id}')" class="p-2 text-red-500 hover:bg-red-50 rounded-full transition" title="Delete Task">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `;
        };

        const setCategoryFilter = (category) => {
            currentCategoryFilter = category;
            selectors.currentViewTitle.textContent = category === 'All' ? 'All Tasks' : category;
            applyFilters();
            renderSidebar();
        };
        
        const setCompletionFilter = (status) => {
            currentCompletionFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('text-gray-700', 'bg-gray-100', 'hover:bg-gray-200');
            });
            document.getElementById(`filter${status.charAt(0).toUpperCase() + status.slice(1)}`).classList.replace('bg-gray-100', 'bg-primary');
            document.getElementById(`filter${status.charAt(0).toUpperCase() + status.slice(1)}`).classList.replace('text-gray-700', 'text-white');
            applyFilters();
        }

        const applyFilters = () => {
            let filteredTasks = tasks;
            const searchTerm = selectors.globalSearch.value.toLowerCase();
            
            // 1. Category Filter
            if (currentCategoryFilter !== 'All') {
                filteredTasks = filteredTasks.filter(t => t.category === currentCategoryFilter);
            }

            // 2. Completion Status Filter
            if (currentCompletionFilter === 'pending') {
                filteredTasks = filteredTasks.filter(t => !t.completed);
            } else if (currentCompletionFilter === 'completed') {
                filteredTasks = filteredTasks.filter(t => t.completed);
            }

            // 3. Search Filter
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(t => 
                    t.title.toLowerCase().includes(searchTerm) || 
                    t.description.toLowerCase().includes(searchTerm)
                );
            }

            // 4. Sorting
            const sortCriteria = selectors.sortCriteria.value;
            filteredTasks.sort((a, b) => {
                switch (sortCriteria) {
                    case 'date_desc': return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'date_asc': return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'due_date_asc': 
                        const dateA = a.dueDate ? new Date(a.dueDate).getTime() : Infinity;
                        const dateB = b.dueDate ? new Date(b.dueDate).getTime() : Infinity;
                        return dateA - dateB;
                    case 'priority_desc':
                        const priorityOrder = ['Urgent', 'High', 'Medium', 'Low'];
                        return priorityOrder.indexOf(b.priority) - priorityOrder.indexOf(a.priority);
                    default: return 0;
                }
            });

            // Re-render
            if (filteredTasks.length === 0) {
                selectors.taskList.innerHTML = '';
                selectors.noTasksMessage.classList.remove('hidden');
            } else {
                selectors.taskList.innerHTML = filteredTasks.map(renderTaskItem).join('');
                selectors.noTasksMessage.classList.add('hidden');
            }
            lucide.createIcons();
        };

        const renderSidebar = () => {
            const counts = categories.reduce((acc, cat) => {
                acc[cat] = tasks.filter(t => t.category === cat && !t.completed).length;
                return acc;
            }, {});

            let html = `
                <li onclick="setCategoryFilter('All')" class="p-3 rounded-lg cursor-pointer flex justify-between items-center transition duration-150 ${currentCategoryFilter === 'All' ? 'bg-primary text-white font-semibold shadow-md' : 'text-gray-700 hover:bg-gray-100'}">
                    <span class="flex items-center"><i data-lucide="layout-grid" class="w-4 h-4 mr-2"></i> All Projects</span>
                    <span>${tasks.filter(t => !t.completed).length}</span>
                </li>
            `;

            categories.forEach(cat => {
                const isActive = currentCategoryFilter === cat;
                html += `
                    <li onclick="setCategoryFilter('${cat}')" class="p-3 rounded-lg cursor-pointer flex justify-between items-center transition duration-150 ${isActive ? 'bg-primary text-white font-semibold shadow-md' : 'text-gray-700 hover:bg-gray-100'}">
                        <span class="flex items-center"><i data-lucide="bookmark" class="w-4 h-4 mr-2"></i> ${cat}</span>
                        <span>${counts[cat]}</span>
                    </li>
                `;
            });

            selectors.categoryList.innerHTML = html;
            lucide.createIcons();
        };

        const updateStats = () => {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;

            document.getElementById('statTotalCount').textContent = total;
            document.getElementById('statCompletedCount').textContent = completed;
            document.getElementById('statPendingCount').textContent = pending;
        };


        // ===========================================
        // 5. INITIALIZATION
        // ===========================================

        const initializeApp = () => {
            loadData();
            renderSidebar();
            applyFilters();
            updateStats();
            lucide.createIcons(); // Initialize all Lucide icons

            // Apply saved theme on load
            if (localStorage.getItem('taskFlowTheme') === 'dark') {
                toggleTheme(); 
            } else {
                // Ensure icons are correctly set for light mode if theme toggle wasn't called
                document.getElementById('themeIcon').setAttribute('data-lucide', 'sun-medium');
            }
        };

        // Execute initialization on DOM content loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>